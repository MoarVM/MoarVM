#!/usr/bin/perl

use strict;
use warnings;
use 5.008;

binmode STDOUT, ':utf8';

my @files = @ARGV;

print <<"END_HEAD";
# This file automatically generated by $0

use QASTNodesMoar;

END_HEAD

foreach my $file (@files) {
    print "# From $file\n\n";
    open(my $fh, "<:utf8",  $file) or die "$file: $!";
    my $emit = 1;
    while (<$fh>) {
        next if /^use [\w:]+;\s*$/;
        if (/^\#\?start_redecl/) {
            $emit = 0;
        }
        elsif (/^\#\?end_redecl/) {
            $emit = 1;
        }
        elsif ($emit) {
            print;
        }
    }
    close $fh;
}

print "\nnqp::bindcomp('qast', QAST::MASTCompiler)\n";
print "\n# vim: set ft=perl6 nomodifiable :\n";
